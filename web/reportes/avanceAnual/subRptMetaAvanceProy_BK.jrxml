<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="subRptMetaAvanceProy" language="groovy" pageWidth="752" pageHeight="100" orientation="Landscape" columnWidth="752" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" isIgnorePagination="true" uuid="205f902f-984b-4e9b-82f2-5d9b09e55890">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="Crosstab Data Text" hAlign="Center"/>
	<parameter name="YEAR" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="META" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="RAMO" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="PROG" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="PERIODO" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
         $P{PROG},
	DECODE(META.CALCULO,'A',NVL(SUM(DGI.ESTIMACION.VALOR),0),MAX(DGI.ESTIMACION.VALOR)) AS VALOR,
	DGI.ESTIMACION_PERIODO.EVALUACION,
	META.META,
	META.DESCR AS META_DESC,
	MEDMET.DESCR AS MEDIDA_DESCR,
	META.CALCULO,
          META.LINEA,
         LINE.DESCR AS LINEA_DESCR,
      DECODE(META.CALCULO,'A',NVL(SUM(DGI.AVANCE.VALOR),0),MAX(DGI.AVANCE.VALOR)) AS AVANCE_VALOR,
	POA.F_CALCULA_ESTIMACION_TEMP($P{RAMO},$P{META},$P{YEAR}, META.CALCULO,EVALUACION) AS ESTIM,
	POA.F_CALCULA_AVANCE_TEMP($P{RAMO},$P{META},$P{YEAR}, META.CALCULO,EVALUACION) AS AVANCE,
    POA.F_CALCULA_ESTIMACION($P{RAMO}, $P{META},$P{YEAR}, META.CALCULO) AS ESTIM_ANUAL,
    POA.F_CALCULA_AVANCE_TEMP1($P{RAMO},$P{META},$P{YEAR}, META.CALCULO,$P{PERIODO}) AS AVANCE_ANUAL



FROM
	DGI.ESTIMACION,
	S_POA_META META,
	S_POA_LOCALIDAD,
	DGI.AVANCE  ,
	S_POA_MEDIDA_META MEDMET,
	DGI.ESTIMACION_PERIODO,
          S_POA_SP_LIN_ESTATAL LINE
WHERE
	( DGI.estimacion.meta (+) = META.meta) and
	( DGI.estimacion.ramo (+) = META.ramo) and
	( DGI.estimacion.year (+) = META.year) and
	( DGI.avance.meta(+) = DGI.estimacion.meta) and
	( DGI.avance.ramo(+) = DGI.estimacion.ramo) and
	( DGI.avance.year(+) = DGI.estimacion.year) and
	( DGI.avance.periodo(+) = DGI.estimacion.periodo) and
	( META.CVE_MEDIDA = MEDMET.MEDIDA ) and
	( META.YEAR = MEDMET.YEAR ) and
	( DGI.ESTIMACION.PERIODO = DGI.ESTIMACION_PERIODO.PERIODO) AND
	( ( META.RAMO = $P{RAMO} ) AND
	( META.YEAR = $P{YEAR}) AND
	( META.META = $P{META} ) ) AND
           (META.LINEA=LINE.LINEA(+))AND

          ( META.PERIODO IS NULL OR META.PERIODO<=$P{PERIODO}) AND
	EVALUACION <= $P{PERIODO}
group by
	DGI.ESTIMACION_PERIODO.EVALUACION,
     META.META,
     META.DESCR,
     MEDMET.DESCR,
     META.CALCULO,
     META.LINEA,
     LINE.DESCR
UNION
SELECT
	$P{PROG},
	DECODE(META.CALCULO,'AC',NVL(SUM(DGI.ESTIMACION.VALOR),0),DECODE(META.CALCULO,'MA',NVL(MAX(DGI.ESTIMACION.VALOR),0),NVL(MIN(DGI.ESTIMACION.VALOR),0))) AS VALOR,
	DGI.ESTIMACION_PERIODO.EVALUACION,
	META.META,
	META.DESCR  AS META_DESC,
	MEDMET.DESCR AS MEDIDA_DESCR,
	META.CALCULO,
          META.LINEA,
          LINE.DESCR,
          	0 AS AVANCE_VALOR,
	POA.F_CALCULA_ESTIMACION_TEMP($P{RAMO}, $P{META}, $P{YEAR}, META.CALCULO,EVALUACION) AS ESTIM,
    POA.F_CALCULA_AVANCE_TEMP($P{RAMO}, $P{META}, $P{YEAR}, META.CALCULO,EVALUACION) AS AVANCE,
    POA.F_CALCULA_ESTIMACION($P{RAMO}, $P{META}, $P{YEAR}, META.CALCULO) AS ESTIM_ANUAL,
    POA.F_CALCULA_AVANCE_TEMP1($P{RAMO},$P{META}, $P{YEAR}, META.CALCULO,$P{PERIODO}) AS AVANCE_ANUAL


FROM
	DGI.ESTIMACION,
	S_POA_META META,
	DGI.AVANCE  ,
	S_POA_MEDIDA_META MEDMET,
	DGI.ESTIMACION_PERIODO,
          S_POA_SP_LIN_ESTATAL LINE
WHERE
	( DGI.estimacion.meta (+) = META.meta) and
	( DGI.estimacion.ramo (+) = META.ramo) and
	( DGI.estimacion.year (+) = META.year) and
	( DGI.avance.meta(+) = DGI.estimacion.meta) and
	( DGI.avance.ramo(+) = DGI.estimacion.ramo) and
	( DGI.avance.year(+) = DGI.estimacion.year) and
	( DGI.avance.periodo(+) = DGI.estimacion.periodo) and
	( META.CVE_MEDIDA = MEDMET.MEDIDA ) and
	( META.YEAR = MEDMET.YEAR ) and
	( DGI.ESTIMACION.PERIODO = DGI.ESTIMACION_PERIODO.PERIODO) AND
	( ( META.RAMO =$P{RAMO} ) AND
	( META.YEAR =$P{YEAR}) AND
	( META.META = $P{META} ) ) AND
           (META.LINEA=LINE.LINEA(+))AND

          ( META.PERIODO IS NULL OR META.PERIODO<=$P{PERIODO}) AND
	EVALUACION >$P{PERIODO}
group by
	DGI.ESTIMACION_PERIODO.EVALUACION,
	META.META,
	META.DESCR,
	MEDMET.DESCR,
	META.CALCULO,
          META.LINEA,
          LINE.DESCR]]>
	</queryString>
	<field name=":1" class="java.lang.String"/>
	<field name="VALOR" class="java.math.BigDecimal"/>
	<field name="EVALUACION" class="java.math.BigDecimal"/>
	<field name="META" class="java.math.BigDecimal"/>
	<field name="META_DESC" class="java.lang.String"/>
	<field name="MEDIDA_DESCR" class="java.lang.String"/>
	<field name="CALCULO" class="java.lang.String"/>
	<field name="LINEA" class="java.lang.String"/>
	<field name="LINEA_DESCR" class="java.lang.String"/>
	<field name="AVANCE_VALOR" class="java.math.BigDecimal"/>
	<field name="ESTIM" class="java.math.BigDecimal"/>
	<field name="AVANCE" class="java.math.BigDecimal"/>
	<field name="ESTIM_ANUAL" class="java.math.BigDecimal"/>
	<field name="AVANCE_ANUAL" class="java.math.BigDecimal"/>
	<variable name="AVANCE_1" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{AVANCE_ANUAL}]]></variableExpression>
	</variable>
	<variable name="ESTIM_1" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{ESTIM_ANUAL}]]></variableExpression>
	</variable>
	<variable name="ESTIM_2" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{ESTIM_ANUAL}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<summary>
		<band height="85" splitType="Stretch">
			<crosstab>
				<reportElement uuid="2bff974e-ea23-4ce2-b740-418f0ffaabd6" x="376" y="27" width="364" height="27" isRemoveLineWhenBlank="true"/>
				<rowGroup name="&apos;001&apos;" width="0">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$P{PROG}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents backcolor="#F0F8FF" mode="Transparent"/>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents/>
					</crosstabTotalRowHeader>
				</rowGroup>
				<columnGroup name="EVALUACION" height="26">
					<bucket class="java.math.BigDecimal">
						<bucketExpression><![CDATA[$F{EVALUACION}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents backcolor="#F0F8FF" mode="Transparent">
							<textField isBlankWhenNull="true">
								<reportElement uuid="25573a35-e9a4-436d-bfd6-5f2143712b68" style="Crosstab Data Text" x="0" y="0" width="80" height="13"/>
								<box>
									<topPen lineWidth="0.5"/>
									<leftPen lineWidth="0.5"/>
									<bottomPen lineWidth="0.5"/>
									<rightPen lineWidth="0.5"/>
								</box>
								<textElement verticalAlignment="Middle">
									<font size="10"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{EVALUACION}]]></textFieldExpression>
							</textField>
							<staticText>
								<reportElement uuid="a60e43a6-2e78-459b-a56d-7143fa7b8f9a" style="Crosstab Data Text" x="0" y="13" width="40" height="13"/>
								<box>
									<topPen lineWidth="0.5"/>
									<leftPen lineWidth="0.5"/>
									<bottomPen lineWidth="0.5"/>
									<rightPen lineWidth="0.5"/>
								</box>
								<textElement verticalAlignment="Middle">
									<font size="10"/>
								</textElement>
								<text><![CDATA[Prog.]]></text>
							</staticText>
							<staticText>
								<reportElement uuid="62f52a75-69a4-4021-a268-b76a8de7e97d" style="Crosstab Data Text" x="40" y="13" width="40" height="13"/>
								<box>
									<topPen lineWidth="0.5"/>
									<leftPen lineWidth="0.5"/>
									<bottomPen lineWidth="0.5"/>
									<rightPen lineWidth="0.5"/>
								</box>
								<textElement verticalAlignment="Middle">
									<font size="10"/>
								</textElement>
								<text><![CDATA[Real]]></text>
							</staticText>
						</cellContents>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents/>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<measure name="VALORMeasure" class="java.lang.String" calculation="Count">
					<measureExpression><![CDATA[$F{ESTIM}]]></measureExpression>
				</measure>
				<measure name="AVANCEMeasure" class="java.lang.String" calculation="Count">
					<measureExpression><![CDATA[($F{EVALUACION}<=$P{PERIODO}?$F{AVANCE}:0)]]></measureExpression>
				</measure>
				<crosstabCell width="81" height="25">
					<cellContents>
						<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
							<reportElement uuid="d7f6fa1d-1cd2-4812-bb66-5102aec6bd2d" style="Crosstab Data Text" x="0" y="0" width="40" height="25"/>
							<textElement>
								<font size="8"/>
								<paragraph spacingBefore="2"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{VALORMeasure}]]></textFieldExpression>
						</textField>
						<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
							<reportElement uuid="c63c27dc-af4b-49a4-ab55-559cc18585f9" style="Crosstab Data Text" x="40" y="0" width="41" height="25"/>
							<textElement>
								<font size="8"/>
								<paragraph spacingBefore="2"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{AVANCEMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell height="25" rowTotalGroup="&apos;001&apos;">
					<cellContents backcolor="#BFE1FF" mode="Opaque">
						<textField>
							<reportElement uuid="df862220-de09-439b-aa43-98034ab0099e" style="Crosstab Data Text" x="0" y="0" width="50" height="25"/>
							<textElement/>
							<textFieldExpression><![CDATA[$V{VALORMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="50" columnTotalGroup="EVALUACION">
					<cellContents backcolor="#BFE1FF" mode="Transparent">
						<textField>
							<reportElement uuid="1df2ee76-baa6-456c-91c2-c64e31093023" style="Crosstab Data Text" x="0" y="0" width="50" height="25"/>
							<textElement/>
							<textFieldExpression><![CDATA[$V{VALORMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell rowTotalGroup="&apos;001&apos;" columnTotalGroup="EVALUACION">
					<cellContents backcolor="#BFE1FF" mode="Transparent">
						<textField>
							<reportElement uuid="797d6d00-f294-41f4-92cf-cb5a8aab4b81" style="Crosstab Data Text" x="0" y="0" width="50" height="25"/>
							<textElement/>
							<textFieldExpression><![CDATA[$V{VALORMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
			</crosstab>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement uuid="f460c07e-cb9f-4677-86e1-447081e6dfe5" stretchType="RelativeToBandHeight" x="0" y="27" width="184" height="27" isRemoveLineWhenBlank="true"/>
				<textElement>
					<font size="6"/>
					<paragraph leftIndent="3" rightIndent="3" spacingBefore="3"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{META_DESC}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement uuid="f0282046-0b8f-4b32-ae1e-30271355c83e" stretchType="RelativeToBandHeight" x="184" y="27" width="72" height="27"/>
				<textElement textAlignment="Center">
					<font size="6"/>
					<paragraph leftIndent="3" spacingBefore="3"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{MEDIDA_DESCR}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="8f81a12b-8fef-4d75-ba09-86a403ac1c26" x="256" y="27" width="60" height="27" isRemoveLineWhenBlank="true"/>
				<textElement textAlignment="Center">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ESTIM_ANUAL}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="cc5a891e-8dd4-45a2-a62c-b1a7c889e220" x="316" y="27" width="60" height="27" isRemoveLineWhenBlank="true"/>
				<textElement textAlignment="Center">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{AVANCE_ANUAL}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement uuid="d6214666-09e4-49de-ab72-de6a25b31cfe" stretchType="RelativeToBandHeight" x="0" y="54" width="72" height="28" isRemoveLineWhenBlank="true"/>
				<textElement verticalAlignment="Middle">
					<font size="7" isPdfEmbedded="true"/>
					<paragraph leftIndent="3" spacingBefore="2"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{LINEA}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement uuid="51483969-4952-411a-a6ca-ab88bbfe3f97" stretchType="RelativeToBandHeight" x="72" y="54" width="444" height="28" isRemoveLineWhenBlank="true"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="7"/>
					<paragraph leftIndent="3" rightIndent="3" spacingBefore="2"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{LINEA_DESCR}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement uuid="8227cfcb-7f1d-4390-b102-bbda2e8b118c" x="0" y="0" width="184" height="27"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<text><![CDATA[META]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="39235020-33e2-4d49-a345-a4ba252e09e6" x="184" y="0" width="72" height="27"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<text><![CDATA[UNIDAD DE MEDIDA]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="bfd36929-8a5b-4667-8b2b-8d939b5b1060" x="256" y="0" width="120" height="10"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center">
					<font size="7"/>
				</textElement>
				<text><![CDATA[CALENDARIZACIÓN]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="3ab0b5a9-7de8-43b6-8125-1912f21c2948" x="256" y="10" width="60" height="17"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<text><![CDATA[PROG.]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="3efe812d-bbbe-47bf-a995-e3faeeecb67b" x="316" y="10" width="60" height="17"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<text><![CDATA[REAL]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="60552b10-9db4-4fbb-8c25-43e054394719" x="376" y="0" width="324" height="27"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<text><![CDATA[METAS ESPERADAS POR TRIMESTRE]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
