<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="rptConsolidadoControlRecalendarizaciones" language="groovy" pageWidth="1500" pageHeight="612" orientation="Landscape" whenNoDataType="NoDataSection" columnWidth="1500" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" isIgnorePagination="true" uuid="960ea9f1-ecf4-4a13-bbcb-dd1214a9aecf">
	<property name="ireport.zoom" value="0.8264462809917424"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<property name="net.sf.jasperreports.export.xls.white.page.background" value="false"/>
	<property name="net.sf.jasperreports.export.xls.remove.empty.space.between.rows" value="true"/>
	<parameter name="YEAR" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="RAMO_IN_LIST" class="java.lang.String"/>
	<parameter name="PERIODO_INI" class="java.lang.Integer"/>
	<parameter name="PERIODO_FIN" class="java.lang.String"/>
	<parameter name="QUERY" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="RPT_DIR" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT
	TR.YEAR,
	TR.RAMO,
	RAMOS.DESCR RAMO_DESCR,
	TR.PRG,
	PROGRAMAS.DESCR PROGRAMA_DESCR,
	SUM(CASE WHEN NVL(REC.IMPTE,0) < 0 THEN 0 ELSE NVL(REC.IMPTE,0) END) AS IMPTE_AUT,
	(
		SELECT
			COUNT(DISTINCT(MOVS.OFICIO))
		FROM
			POA.MOVOFICIOS MOVS,
			POA.MOVOFICIOS_ACCION_REQ MOVSREQ
		WHERE
			EXTRACT(YEAR FROM MOVS.FECPPTO) = $P{YEAR} AND
			EXTRACT(MONTH FROM MOVS.FECPPTO) >= $P{PERIODO_INI} AND
			EXTRACT(MONTH FROM MOVS.FECPPTO) <= $P{PERIODO_FIN} AND
			MOVS.TIPOMOV = 'C' AND
			MOVS.STATUS <> 'X' AND
			MOVSREQ.YEAR = EXTRACT(YEAR FROM MOVS.FECHAELAB) AND
			MOVSREQ.OFICIO = MOVS.OFICIO AND
			MOVSREQ.CONSIDERAR = 'S' AND
			MOVSREQ.RAMO IN($P!{RAMO_IN_LIST}) AND
			MOVSREQ.RAMO = TR.RAMO AND
			MOVSREQ.PRG = TR.PRG

	) REC_SOLICITADAS,
	(
		SELECT
			COUNT(DISTINCT(MOVS.OFICIO))
		FROM
			POA.MOVOFICIOS MOVS,
			POA.MOVOFICIOS_ACCION_REQ MOVSREQ
		WHERE
			EXTRACT(YEAR FROM MOVS.FECPPTO) = $P{YEAR} AND
			EXTRACT(MONTH FROM MOVS.FECPPTO) >=$P{PERIODO_INI} AND
			EXTRACT(MONTH FROM MOVS.FECPPTO) <= $P{PERIODO_FIN} AND
			MOVS.TIPOMOV = 'C' AND
			MOVS.STATUS = 'A' AND
			MOVSREQ.YEAR = EXTRACT(YEAR FROM MOVS.FECHAELAB) AND
			MOVSREQ.OFICIO = MOVS.OFICIO AND
			MOVSREQ.CONSIDERAR = 'S' AND
			MOVSREQ.RAMO IN($P!{RAMO_IN_LIST}) AND
			MOVSREQ.RAMO = TR.RAMO AND
			MOVSREQ.PRG = TR.PRG

	) REC_AUTORIZADAS
FROM
	POA.MOVOFICIOS MOVOF,
	POA.MOVOFICIOS_ACCION_REQ TR,
	SPP.RECALENDARIZACION REC,
	DGI.RAMOS RAMOS,
	S_POA_PROGRAMA PROGRAMAS
WHERE
	EXTRACT(YEAR FROM MOVOF.FECPPTO) = $P{YEAR} AND
	EXTRACT(MONTH FROM MOVOF.FECPPTO) >=$P{PERIODO_INI} AND
	EXTRACT(MONTH FROM MOVOF.FECPPTO) <=$P{PERIODO_FIN} AND
	MOVOF.TIPOMOV = 'C' AND
	MOVOF.STATUS <> 'X' AND
	TR.YEAR = EXTRACT(YEAR FROM MOVOF.FECHAELAB) AND
	TR.OFICIO = MOVOF.OFICIO AND
	TR.CONSIDERAR = 'S' AND
	TR.RAMO IN($P!{RAMO_IN_LIST}) AND
	REC.OFICIO (+)= TR.OFICIO AND
	REC.RAMO (+)= TR.RAMO AND
	REC.PRG (+)= TR.PRG AND
	REC.DEPTO (+)= TR.DEPTO AND
	REC.META (+)= TR.META AND
	REC.ACCION (+)= TR.ACCION AND
	REC.REQUERIMIENTO (+)= TR.REQUERIMIENTO AND
	RAMOS.YEAR = TR.YEAR AND
	RAMOS.RAMO = TR.RAMO AND
	PROGRAMAS.YEAR = TR.YEAR AND
	PROGRAMAS.PRG = TR.PRG
	$P!{QUERY}

GROUP BY
	TR.YEAR,
	TR.RAMO,
	RAMOS.DESCR,
	TR.PRG,
	PROGRAMAS.DESCR

ORDER BY
	TR.RAMO,
	TR.PRG]]>
	</queryString>
	<field name="YEAR" class="java.lang.String"/>
	<field name="RAMO" class="java.lang.String"/>
	<field name="RAMO_DESCR" class="java.lang.String"/>
	<field name="PRG" class="java.lang.String"/>
	<field name="PROGRAMA_DESCR" class="java.lang.String"/>
	<field name="IMPTE_AUT" class="java.math.BigDecimal"/>
	<field name="REC_SOLICITADAS" class="java.math.BigDecimal"/>
	<field name="REC_AUTORIZADAS" class="java.math.BigDecimal"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="60">
			<staticText>
				<reportElement uuid="95b59981-9d2f-4ba4-b1ca-5823b25c8057" stretchType="RelativeToBandHeight" mode="Opaque" x="0" y="0" width="50" height="60" forecolor="#FFFFFF" backcolor="#376091"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="SansSerif" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Ramo]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="25144848-e30f-45d3-ac9e-9cb28300cdd9" stretchType="RelativeToBandHeight" mode="Opaque" x="50" y="0" width="400" height="60" forecolor="#FFFFFF" backcolor="#376091"/>
				<textElement verticalAlignment="Middle">
					<font fontName="SansSerif" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Ramo Redacción]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="cbe89956-6e0e-4348-93e8-6130dc2a5d9d" stretchType="RelativeToBandHeight" mode="Opaque" x="450" y="0" width="50" height="60" forecolor="#FFFFFF" backcolor="#376091"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="SansSerif" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Programa]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="50f9607c-7944-4f7e-933a-5c8673a815e1" stretchType="RelativeToBandHeight" mode="Opaque" x="500" y="0" width="400" height="60" forecolor="#FFFFFF" backcolor="#376091"/>
				<textElement verticalAlignment="Middle">
					<font fontName="SansSerif" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Programa Redacción]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="1a784f0f-2832-46fe-a879-d6edf6cc4a8a" mode="Opaque" x="900" y="0" width="173" height="60" forecolor="#FFFFFF" backcolor="#376091"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Recalendarizaciones Solicitadas]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="73f6a34c-c5a1-4d61-ad5a-7b4740415c50" mode="Opaque" x="1073" y="0" width="211" height="60" forecolor="#FFFFFF" backcolor="#376091"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Recalendarizaciones Autorizadas]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="a4143e95-7c85-4f5d-ac9c-21ece2550cc4" mode="Opaque" x="1284" y="0" width="198" height="60" forecolor="#FFFFFF" backcolor="#376091"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Impte de Recalendarizacion Autorizada]]></text>
			</staticText>
		</band>
	</title>
	<detail>
		<band height="41" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement uuid="e0af002e-c635-4736-95c6-f1e42a4e1a11" stretchType="RelativeToBandHeight" x="0" y="0" width="50" height="40"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="SansSerif" size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{RAMO}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement uuid="e8fdcaab-bd2d-4883-a56c-eae921df831f" stretchType="RelativeToBandHeight" x="50" y="0" width="400" height="40"/>
				<textElement verticalAlignment="Middle">
					<font fontName="SansSerif" size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{RAMO_DESCR}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement uuid="b1278004-3e98-4979-9252-b2eed452bc93" stretchType="RelativeToBandHeight" x="450" y="0" width="50" height="40"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="SansSerif" size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{PRG}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement uuid="586d5844-d37d-427e-a070-8dbf7c32163c" stretchType="RelativeToBandHeight" x="500" y="0" width="400" height="40"/>
				<textElement verticalAlignment="Middle">
					<font fontName="SansSerif" size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{PROGRAMA_DESCR}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="e04be772-3943-481d-9b32-c4c2ca7acd99" x="900" y="0" width="173" height="40"/>
				<textElement/>
				<textFieldExpression><![CDATA[$F{REC_SOLICITADAS}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="2a568b18-5bdc-4d98-ba82-ae923cf0a5f2" x="1073" y="0" width="211" height="40"/>
				<textElement/>
				<textFieldExpression><![CDATA[$F{REC_AUTORIZADAS}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement uuid="c672a041-db1a-4356-b9ad-0844f042d8cc" x="1284" y="0" width="198" height="40"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA[$F{IMPTE_AUT}.equals(null)?0.00:$F{IMPTE_AUT}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
