<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="subRptPresupIngEgreBalanceFinalDisponible" language="groovy" pageWidth="752" pageHeight="20" orientation="Landscape" whenNoDataType="AllSectionsNoDetail" columnWidth="752" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="e2bd292f-5a3e-4403-969b-968c6c0ca019">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="Porcentaje1">
		<conditionalStyle>
			<conditionExpression><![CDATA[($F{ASIGNADO}-$F{MODIFICADO}) >= 0]]></conditionExpression>
			<style forecolor="#000000" pattern=""/>
		</conditionalStyle>
		<conditionalStyle>
			<conditionExpression><![CDATA[($F{ASIGNADO}-$F{MODIFICADO}) < 0]]></conditionExpression>
			<style forecolor="#FF0000" pattern="">
				<pen lineColor="#000000"/>
				<box>
					<pen lineColor="#000000"/>
					<topPen lineColor="#000000"/>
					<leftPen lineColor="#000000"/>
					<bottomPen lineColor="#000000"/>
					<rightPen lineColor="#000000"/>
				</box>
			</style>
		</conditionalStyle>
	</style>
	<style name="Inicial">
		<conditionalStyle>
			<conditionExpression><![CDATA[$F{ASIGNADO_CAP} >= 0]]></conditionExpression>
			<style forecolor="#000000"/>
		</conditionalStyle>
		<conditionalStyle>
			<conditionExpression><![CDATA[$F{ASIGNADO_CAP} < 0]]></conditionExpression>
			<style forecolor="#FF0000">
				<pen lineColor="#000000"/>
				<box>
					<pen lineColor="#000000"/>
					<topPen lineColor="#000000"/>
					<leftPen lineColor="#000000"/>
					<bottomPen lineColor="#000000"/>
					<rightPen lineColor="#000000"/>
				</box>
			</style>
		</conditionalStyle>
	</style>
	<style name="Asignado">
		<conditionalStyle>
			<conditionExpression><![CDATA[$F{MODIFICADO} >= 0]]></conditionExpression>
			<style forecolor="#000000">
				<pen lineColor="#000000"/>
				<box>
					<pen lineColor="#000000"/>
					<topPen lineColor="#000000"/>
					<leftPen lineColor="#000000"/>
					<bottomPen lineColor="#000000"/>
					<rightPen lineColor="#000000"/>
				</box>
			</style>
		</conditionalStyle>
		<conditionalStyle>
			<conditionExpression><![CDATA[$F{MODIFICADO} < 0]]></conditionExpression>
			<style forecolor="#FF0000">
				<pen lineColor="#000000"/>
				<box>
					<pen lineColor="#000000"/>
					<topPen lineColor="#000000"/>
					<leftPen lineColor="#000000"/>
					<bottomPen lineColor="#000000"/>
					<rightPen lineColor="#000000"/>
				</box>
			</style>
		</conditionalStyle>
	</style>
	<style name="Presupuestado">
		<conditionalStyle>
			<conditionExpression><![CDATA[$F{ASIGNADO} >= 0]]></conditionExpression>
			<style forecolor="#000000">
				<pen lineColor="#000000"/>
				<box>
					<pen lineColor="#000000"/>
					<topPen lineColor="#000000"/>
					<leftPen lineColor="#000000"/>
					<bottomPen lineColor="#000000"/>
					<rightPen lineColor="#000000"/>
				</box>
			</style>
		</conditionalStyle>
		<conditionalStyle>
			<conditionExpression><![CDATA[$F{ASIGNADO} < 0]]></conditionExpression>
			<style forecolor="#FF0000">
				<pen lineColor="#000000"/>
				<box>
					<pen lineColor="#000000"/>
					<topPen lineColor="#000000"/>
					<leftPen lineColor="#000000"/>
					<bottomPen lineColor="#000000"/>
					<rightPen lineColor="#000000"/>
				</box>
			</style>
		</conditionalStyle>
	</style>
	<parameter name="RAMO" class="java.lang.String"/>
	<parameter name="YEAR_SIG" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT
	NVL(PPTO_INGP.ASIGNADO,0) - NVL(PPTO_CAPTURA_ASIG.ASIGNADO,0) AS ASIGNADO_CAP,
	NVL(PPTO_INGP.PRESUP_MODIFICADO,0) - NVL(PPTO_CAPTURA_ASIG.PRESUP_MODIFICADO,0) AS MODIFICADO,
	NVL(PPTO_INGP.PRESUPSIG,0) - NVL(PPTO_ASIG.ASIGNADO,0) AS ASIGNADO
FROM
	(
		SELECT
			NVL(SUM(NVL(ACT.ASIGNADO,0)),0) AS ASIGNADO,
			NVL(SUM(NVL(ACT.ASIGNADO,0)),0) + NVL(SUM(NVL(ACT.MVTOS,0)),0) AS PRESUP_MODIFICADO
		FROM
			(
				SELECT
					ANT.YEAR,
					ANT.RAMO,
					SUM(NVL(ANT.ASIGNADO,0)) AS ASIGNADO,
					SUM(NVL(ANT.MVTOS_PRESUP,0)) AS MVTOS
				FROM
					(
						SELECT
							ASIG.RAMO,
							ASIG.YEAR,
							SUM(NVL(ASIG.ASIGNADO,0)) AS ASIGNADO,
							0 AS MVTOS_PRESUP
						FROM
							(
								SELECT
									YEAR,
									RAMO,
									PARTIDA,
									ASIGNADO
								FROM
									SPP.PPTO
							) ASIG
						WHERE
							ASIG.YEAR = $P{YEAR_SIG}
							AND ASIG.RAMO IN($P{RAMO})
						GROUP BY
							ASIG.RAMO,
							ASIG.YEAR

						UNION ALL

						SELECT
							MVTOS.RAMO,
							MVTOS.YEAR,
							0 AS ASIGNADO,
							SUM(NVL(MVTOS.AMPLIACION,0)) + SUM(NVL(MVTOS.REDUCCION,0)) AS MVTOS_PRESUP
						FROM
							(
								SELECT
									TO_CHAR(EJERCICIO) YEAR,
									RAMO,
									PROGRAMA PRG,
									TO_CHAR(PARTIDA) PARTIDA,
									0 ASIGNADO,
									AMP AMPLIACION,
									RED REDUCCION,
									MES
								FROM
									S_CIM_CIERRE_PPTO_ARMO_MEN_PG
							) MVTOS
						WHERE
							MVTOS.YEAR = $P{YEAR_SIG}
							AND MVTOS.RAMO IN($P{RAMO})
							AND MVTOS.MES <= 12
						GROUP BY
							MVTOS.RAMO,
							MVTOS.YEAR
					) ANT
				GROUP BY
					ANT.YEAR,
					ANT.RAMO
			) ACT
		WHERE
			ACT.RAMO IN($P{RAMO})
			AND ACT.YEAR = $P{YEAR_SIG}
		GROUP BY
			ACT.RAMO
	) PPTO_CAPTURA_ASIG,
	(
		SELECT
			SUM(NVL(SPP.PPTO.ASIGNADO,0)) AS ASIGNADO
		FROM
			SPP.PPTO
		WHERE
			SPP.PPTO.YEAR=TO_CHAR(TO_NUMBER($P{YEAR_SIG})+1) AND
			SPP.PPTO.RAMO=$P{RAMO}
	) PPTO_ASIG,
	(
		SELECT
			NVL(PPTO_ING_CAPTURA.PRESUP_ASIGNADO,0) AS ASIGNADO,
			NVL(PPTO_ING_CAPTURA.MODIFICADO,0) AS PRESUP_MODIFICADO,
			NVL(PPTO_ING.PRESUP,0) AS PRESUPSIG
		FROM
			(
			SELECT
			SUM(NVL(PIC.ASIGNADO,0)) AS PRESUP_ASIGNADO,
			SUM(NVL(PIC.PRESUP_MODIFICADO,0)) AS MODIFICADO
		FROM
			(
				SELECT
					PPING.YEAR,
					PPING.RAMO,
					PPING.RUBRO,
					SUM(NVL(PPING.ASIGNADO,0)) ASIGNADO,
					SUM(NVL(PPING.PRESUP_MODIFICADO,0)) PRESUP_MODIFICADO
				FROM
					S_POA_PPTO_ING_CAPTURA_ANT PPING
				GROUP BY
					PPING.YEAR,
					PPING.RAMO,
					PPING.RUBRO

				UNION

				SELECT
					PPING.YEAR,
					PPING.RAMO,
					PPING.RUBRO,
					SUM(NVL(PPING.ASIGNADO,0)) ASIGNADO,
					SUM(NVL(PPING.ASIGNADO,0)) + SUM(NVL(PPING.AMPLIACIONES,0)) - SUM(NVL(PPING.REDUCCIONES,0)) PRESUP_MODIFICADO
				FROM
					(
						SELECT
							PPI.YEAR,
							PPI.RAMO,
							PCL.RUBRO,
							SUM(NVL(PPI.ENE,0)+NVL(PPI.FEB,0)+NVL(PPI.MZO,0)+NVL(PPI.ABR,0)+NVL(PPI.MAY,0)+NVL(PPI.JUN,0)+NVL(PPI.JUL,0)+NVL(PPI.AGO,0)+NVL(PPI.SEP,0)+NVL(PPI.OCT,0)+NVL(PPI.NOV,0)+NVL(PPI.DIC,0)) AS ASIGNADO,
							0 AMPLIACIONES,
							0 REDUCCIONES
						FROM
							DGI.POA_PPTO_ING PPI,
							S_ING_CONCEP PCL
						WHERE
							PPI.CONCEPTO=PCL.CONCEPTO AND
							PCL.EJERCICIO = $P{YEAR_SIG}
						GROUP BY
							PPI.YEAR,
							PPI.RAMO,
							PCL.RUBRO

						UNION ALL

						SELECT
							PPI.YEAR,
							PPI.RAMO,
							PCL.RUBRO,
							0 AS ASIGNADO,
							CASE PPI.TIPOMOV WHEN 'A' THEN SUM(NVL(PPI.ENE,0)+NVL(PPI.FEB,0)+NVL(PPI.MZO,0)+NVL(PPI.ABR,0)+NVL(PPI.MAY,0)+NVL(PPI.JUN,0)+NVL(PPI.JUL,0)+NVL(PPI.AGO,0)+NVL(PPI.SEP,0)+NVL(PPI.OCT,0)+NVL(PPI.NOV,0)+NVL(PPI.DIC,0)) ELSE 0 END AMPLIACIONES,
							CASE PPI.TIPOMOV WHEN 'R' THEN SUM(NVL(PPI.ENE,0)+NVL(PPI.FEB,0)+NVL(PPI.MZO,0)+NVL(PPI.ABR,0)+NVL(PPI.MAY,0)+NVL(PPI.JUN,0)+NVL(PPI.JUL,0)+NVL(PPI.AGO,0)+NVL(PPI.SEP,0)+NVL(PPI.OCT,0)+NVL(PPI.NOV,0)+NVL(PPI.DIC,0)) ELSE 0 END REDUCCIONES
						FROM
							POA.CARATULA_PPTO_ING PPI,
							S_ING_CONCEP PCL
						WHERE
							PPI.CONCEPTO=PCL.CONCEPTO AND
							PCL.EJERCICIO = $P{YEAR_SIG}
						GROUP BY
							PPI.YEAR,
							PPI.RAMO,
							PCL.RUBRO,
							PPI.TIPOMOV
					) PPING
				GROUP BY
					PPING.YEAR,
					PPING.RAMO,
					PPING.RUBRO
			) PIC
		WHERE
			PIC.RAMO = $P{RAMO} AND
			PIC.YEAR = $P{YEAR_SIG}
			) PPTO_ING_CAPTURA,
			(
				SELECT
					SUM(NVL(PPI.ENE,0)+NVL(PPI.FEB,0)+NVL(PPI.MZO,0)+NVL(PPI.ABR,0)+NVL(PPI.MAY,0)+NVL(PPI.JUN,0)+NVL(PPI.JUL,0)+NVL(PPI.AGO,0)+NVL(PPI.SEP,0)+NVL(PPI.OCT,0)+NVL(PPI.NOV,0)+NVL(PPI.DIC,0)) AS PRESUP
				FROM
					DGI.POA_PPTO_ING PPI
				WHERE
					PPI.RAMO=$P{RAMO} AND
					PPI.YEAR=TO_CHAR(TO_NUMBER($P{YEAR_SIG})+1)
			) PPTO_ING
		GROUP BY
			NVL(PPTO_ING_CAPTURA.PRESUP_ASIGNADO,0),
			NVL(PPTO_ING_CAPTURA.MODIFICADO,0),
			NVL(PPTO_ING.PRESUP,0)
	) PPTO_INGP]]>
	</queryString>
	<field name="ASIGNADO_CAP" class="java.math.BigDecimal"/>
	<field name="MODIFICADO" class="java.math.BigDecimal"/>
	<field name="ASIGNADO" class="java.math.BigDecimal"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<detail>
		<band height="20" splitType="Stretch">
			<textField pattern="¤ #,##0.00;(¤ #,##0.00)" isBlankWhenNull="true">
				<reportElement uuid="b899cb4e-8115-44bc-afe6-0eb7a8c4c6b9" style="Porcentaje1" x="574" y="0" width="122" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ASIGNADO}-$F{MODIFICADO}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00;(¤ #,##0.00)" isBlankWhenNull="true">
				<reportElement uuid="042446a8-aac0-473c-bc8e-2de602cb585f" style="Asignado" x="354" y="0" width="100" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{MODIFICADO}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00;(¤ #,##0.00)" isBlankWhenNull="true">
				<reportElement uuid="5d3ff512-e0ee-41f6-af99-9263a307acf1" style="Presupuestado" x="454" y="0" width="120" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ASIGNADO}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00 %;(#,##0.00 %)" isBlankWhenNull="true">
				<reportElement uuid="1250c26f-f9df-43bc-a820-1b166b6e7a87" style="Porcentaje1" x="696" y="0" width="56" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{MODIFICADO} == 0 ? "0 %" : ($F{ASIGNADO}-$F{MODIFICADO})/$F{MODIFICADO}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement uuid="15efe311-dfb1-4c20-9675-41f2f994f97c" x="0" y="0" width="238" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle" markup="none">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[BALANCE FINAL DE DISPONIBILIDADES]]></text>
			</staticText>
			<textField pattern="¤ #,##0.00;(¤ #,##0.00)" isBlankWhenNull="true">
				<reportElement uuid="b34d9612-75fb-4a01-92af-741f843113f2" style="Inicial" x="238" y="0" width="116" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ASIGNADO_CAP}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
