<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="rptPptoPart" language="groovy" pageWidth="612" pageHeight="792" columnWidth="592" leftMargin="10" rightMargin="10" topMargin="10" bottomMargin="10" uuid="b7175885-fd37-4424-b6d0-29ca3b3df42a">
	<property name="ireport.zoom" value="1.3310000000000188"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="YEAR" class="java.lang.Integer"/>
	<parameter name="RAMO_IN_LIST" class="java.lang.String">
		<defaultValueExpression><![CDATA[""]]></defaultValueExpression>
	</parameter>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["C:\\desarrollo\\repositorio_local\\POA\\web\\reportes\\"]]></defaultValueExpression>
	</parameter>
	<parameter name="IMG_DIR" class="java.lang.String"/>
	<parameter name="QUERY" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="MODACT" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT
	PPTO.YEAR,
	G.GRUPO,
	G.DESCR AS GRUPO_DESCR,
    SG.SUBGRUPO,
    SG.DESCR AS SUBGPO_DESCR,
    SSG.SUBSUBGRUPO,
    SSG.DESCR AS SUBSUBGPO_DESR,
    PART.PARTIDA,
    PART.DESCR AS PART_DESCR,
	--SUM(PPTO.ASIGNADO) AS ASIGNADO,
	PRAM.GOBIERNO,
	PRAM.SECRETARIA,
	SYSDATE AS FECHA,
SUM(PPTO.ENEACT + PPTO.FEBACT + PPTO.MARACT + PPTO.ABRACT + PPTO.MAYACT + PPTO.JUNACT + PPTO.JULACT + PPTO.AGOACT + PPTO.SEPACT + PPTO.OCTACT + PPTO.NOVACT +PPTO.DICACT) AS ASIGNADO


FROM
	SPP.VW_PRESUP_ASIG_MEN PPTO,
	DGI.PARTIDA PART,
	S_DGI_GRUPOS G,
	S_DGI_SUBGRUPOS SG,
	S_DGI_SUBSUBGPO SSG,
	DGI.PARAMETROS PRAM

WHERE
	PPTO.YEAR = $P{YEAR} AND
	PPTO.RAMO IN($P!{RAMO_IN_LIST}) AND
    	$P!{QUERY}
	SSG.YEAR = PART.YEAR AND
	SSG.SUBSUBGRUPO = PART.SUBSUBGPO AND
	SG.YEAR = SSG.YEAR AND
	SG.SUBGRUPO = SSG.SUBGRUPO AND
    PART.YEAR = PPTO.YEAR AND
    PART.PARTIDA = PPTO.PARTIDA AND
	G.YEAR = SG.YEAR AND
	G.GRUPO = SG.GRUPO

GROUP BY
	PPTO.YEAR,
	G.GRUPO,
	G.DESCR,
    SG.SUBGRUPO,
    SG.DESCR,
    SSG.SUBSUBGRUPO,
    SSG.DESCR,
    PART.PARTIDA,
    PART.DESCR,
	PRAM.GOBIERNO,
	PRAM.SECRETARIA

ORDER BY
	PPTO.YEAR,
	G.GRUPO,
	G.DESCR,
    SG.SUBGRUPO,
    SG.DESCR,
    SSG.SUBSUBGRUPO,
    SSG.DESCR,
    PART.PARTIDA,
    PART.DESCR,
   	PRAM.GOBIERNO,
	PRAM.SECRETARIA,SYSDATE]]>
	</queryString>
	<field name="YEAR" class="java.lang.String"/>
	<field name="GRUPO" class="java.lang.String"/>
	<field name="GRUPO_DESCR" class="java.lang.String"/>
	<field name="SUBGRUPO" class="java.lang.String"/>
	<field name="SUBGPO_DESCR" class="java.lang.String"/>
	<field name="SUBSUBGRUPO" class="java.lang.String"/>
	<field name="SUBSUBGPO_DESR" class="java.lang.String"/>
	<field name="PARTIDA" class="java.lang.String"/>
	<field name="PART_DESCR" class="java.lang.String"/>
	<field name="ASIGNADO" class="java.math.BigDecimal"/>
	<field name="GOBIERNO" class="java.lang.String"/>
	<field name="SECRETARIA" class="java.lang.String"/>
	<field name="FECHA" class="java.sql.Timestamp"/>
	<variable name="GeneralAsignado" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{ASIGNADO}]]></variableExpression>
		<initialValueExpression><![CDATA[BigDecimal.valueOf(0)]]></initialValueExpression>
	</variable>
	<variable name="ProgramaAsignado" class="java.math.BigDecimal" resetType="Group" resetGroup="GRUPO" calculation="Sum">
		<variableExpression><![CDATA[$F{ASIGNADO}]]></variableExpression>
		<initialValueExpression><![CDATA[BigDecimal.valueOf(0)]]></initialValueExpression>
	</variable>
	<variable name="ASIGNADO_1" class="java.math.BigDecimal" resetType="Group" resetGroup="SUBSUBGPO" calculation="Sum">
		<variableExpression><![CDATA[$F{ASIGNADO}]]></variableExpression>
	</variable>
	<variable name="ASIGNADO_2" class="java.math.BigDecimal" resetType="Group" resetGroup="SUBGRUPO" calculation="Sum">
		<variableExpression><![CDATA[$F{ASIGNADO}]]></variableExpression>
	</variable>
	<group name="GRUPO">
		<groupExpression><![CDATA[$F{GRUPO}]]></groupExpression>
		<groupHeader>
			<band height="12">
				<textField isBlankWhenNull="true">
					<reportElement uuid="aac12e44-4810-4cea-af26-eeae6a0a2735" x="2" y="0" width="590" height="12"/>
					<textElement verticalAlignment="Top" markup="none">
						<font fontName="SansSerif" size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{GRUPO}+" "+$F{GRUPO_DESCR}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="12">
				<printWhenExpression><![CDATA[$V{ProgramaAsignado} > 0]]></printWhenExpression>
				<textField isBlankWhenNull="true">
					<reportElement uuid="71acc13e-7f5c-406a-908e-c1413c384e43" x="363" y="0" width="121" height="12"/>
					<textElement verticalAlignment="Top" markup="none">
						<font fontName="SansSerif" size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA["Total por Capítulo "]]></textFieldExpression>
				</textField>
				<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
					<reportElement uuid="8e850f47-5e61-4c24-a98b-926c5e95269b" x="484" y="0" width="108" height="12"/>
					<textElement textAlignment="Right" verticalAlignment="Top" markup="none">
						<font fontName="SansSerif" size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{ProgramaAsignado}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<group name="SUBGRUPO">
		<groupExpression><![CDATA[$F{SUBGRUPO}]]></groupExpression>
		<groupHeader>
			<band height="12">
				<textField isBlankWhenNull="true">
					<reportElement uuid="5bc4b8d5-20a5-4ecf-a461-9727388514ef" x="7" y="0" width="585" height="12"/>
					<textElement verticalAlignment="Top" markup="none">
						<font fontName="SansSerif" size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{SUBGRUPO}+" "+$F{SUBGPO_DESCR}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="12">
				<printWhenExpression><![CDATA[$V{ASIGNADO_2} > 0]]></printWhenExpression>
				<textField isBlankWhenNull="true">
					<reportElement uuid="c08013d7-2623-46ae-b4e2-24d10f23a5c9" x="363" y="0" width="121" height="12"/>
					<textElement verticalAlignment="Top" markup="none">
						<font fontName="SansSerif" size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA["Total por Concepto "]]></textFieldExpression>
				</textField>
				<textField pattern="¤ #,##0.00">
					<reportElement uuid="bee5900a-6ea8-4ca6-9ab2-6af8e36d16d6" x="484" y="0" width="108" height="12"/>
					<textElement textAlignment="Right">
						<font size="8"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{ASIGNADO_2}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<group name="SUBSUBGPO">
		<groupExpression><![CDATA[$F{SUBSUBGRUPO}]]></groupExpression>
		<groupHeader>
			<band height="12">
				<textField isBlankWhenNull="true">
					<reportElement uuid="349327e0-e486-4baa-91c5-981bb47ba974" x="12" y="0" width="580" height="12"/>
					<textElement verticalAlignment="Top" markup="none">
						<font fontName="SansSerif" size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{SUBSUBGRUPO}+" "+$F{SUBSUBGPO_DESR}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="12">
				<printWhenExpression><![CDATA[$V{ASIGNADO_1} > 0]]></printWhenExpression>
				<textField isBlankWhenNull="true">
					<reportElement uuid="47e1bd4f-b34b-427b-8f70-cca26aa9da4a" x="363" y="0" width="121" height="12"/>
					<textElement verticalAlignment="Top" markup="none">
						<font fontName="SansSerif" size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA["Total por Partida genérica "]]></textFieldExpression>
				</textField>
				<textField pattern="¤ #,##0.00">
					<reportElement uuid="d655b51c-e272-44b6-962e-6d8692ca69de" x="484" y="0" width="108" height="12"/>
					<textElement textAlignment="Right">
						<font size="8"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{ASIGNADO_1}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="118">
			<line>
				<reportElement uuid="1d3be814-588d-4f2c-973f-13545b01ff28" x="0" y="115" width="592" height="1"/>
			</line>
			<textField isBlankWhenNull="true">
				<reportElement uuid="193ae223-68ce-4eaa-9c20-d2124762461e" x="65" y="0" width="462" height="18"/>
				<textElement textAlignment="Center" verticalAlignment="Top">
					<font fontName="SansSerif" size="14" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{GOBIERNO}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="82d8947e-094c-49bc-a69a-d66b7509c3e3" x="65" y="18" width="462" height="16"/>
				<textElement textAlignment="Center" verticalAlignment="Top">
					<font fontName="SansSerif" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{SECRETARIA}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="5c259b52-9a61-4e75-883f-ec887db2686c" x="65" y="34" width="462" height="14"/>
				<textElement textAlignment="Center" verticalAlignment="Top" markup="none">
					<font fontName="SansSerif" size="10" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{MODACT}.equals("ACT") ? "PRESUPUESTO MODIFICADO ANUAL" : "PRESUPUESTO ASIGNADO ANUAL"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="5b4ac66c-64fc-4f5c-addb-c1683780070a" x="65" y="48" width="462" height="14"/>
				<textElement textAlignment="Center" verticalAlignment="Top" markup="none">
					<font fontName="SansSerif" size="10" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["PARTIDA "+ $P{YEAR}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement uuid="de5bb955-640f-4d08-9f59-1209b81d6d2b" x="513" y="101" width="79" height="12"/>
				<textElement textAlignment="Right" verticalAlignment="Top">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="1475a71a-9a60-4950-81f4-d72e7cdc9fd8" x="2" y="65" width="511" height="12"/>
				<textElement verticalAlignment="Top">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Capítulo]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="1f3d595f-1132-4634-8d97-fd7b2fe22f81" x="18" y="101" width="495" height="12"/>
				<textElement verticalAlignment="Top">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Partida]]></text>
			</staticText>
			<image>
				<reportElement uuid="8ecc0849-301d-4212-88f1-ff3361bab9e9" x="0" y="0" width="65" height="59"/>
				<imageExpression><![CDATA[$P{IMG_DIR} + "EDO.gif"]]></imageExpression>
			</image>
			<staticText>
				<reportElement uuid="3428b0e7-5a97-4644-9047-624cf38c99e0" x="12" y="89" width="501" height="12"/>
				<textElement verticalAlignment="Top">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Partida Genérica]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="dcdac9b5-786f-44f4-8c76-f5dd4a67f844" x="7" y="77" width="506" height="12"/>
				<textElement verticalAlignment="Top">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Concepto]]></text>
			</staticText>
		</band>
	</pageHeader>
	<detail>
		<band height="12" splitType="Stretch">
			<printWhenExpression><![CDATA[$F{ASIGNADO} > 0]]></printWhenExpression>
			<textField isBlankWhenNull="true">
				<reportElement uuid="cc454cc9-8da3-4c46-a4cc-aa84c96e24d6" x="18" y="0" width="466" height="12"/>
				<textElement verticalAlignment="Top" markup="none">
					<font fontName="SansSerif" size="8" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{PARTIDA}+" "+$F{PART_DESCR}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement uuid="d8d79959-1c31-4c59-927c-169b9cd5f07a" x="484" y="0" width="108" height="12"/>
				<textElement textAlignment="Right" verticalAlignment="Top" markup="none">
					<font fontName="SansSerif" size="8" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ASIGNADO}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band height="11" splitType="Stretch">
			<textField pattern="dd/MM/yyyy HH.mm.ss">
				<reportElement uuid="1e825092-9443-4d79-8296-59c51232005f" x="0" y="1" width="592" height="10"/>
				<textElement textAlignment="Center">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{FECHA}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement uuid="8f3086f4-326e-4acd-9aa2-a78411f2665e" x="0" y="0" width="592" height="1"/>
			</line>
			<textField pattern="dd/MM/yyyy HH.mm.ss">
				<reportElement uuid="769e604e-48f1-4b4e-bc1d-e4c9361618b3" x="0" y="1" width="109" height="10"/>
				<textElement>
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA["<rptPptoPart>"]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="a129b929-d1f7-439d-9419-e87e54092535" x="484" y="0" width="80" height="11"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA["Página "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement uuid="98bd0109-1c18-45ef-9f8b-160c09689f09" x="564" y="0" width="28" height="11"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="12" splitType="Stretch">
			<textField isBlankWhenNull="true">
				<reportElement uuid="1dd5b60b-bf0f-4133-b2e5-80fa258ae28e" x="363" y="0" width="121" height="12"/>
				<textElement verticalAlignment="Top" markup="none">
					<font fontName="SansSerif" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Total General"]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement uuid="afdbca4f-d50d-4dfb-a94a-674d5cafec22" x="484" y="0" width="108" height="12"/>
				<textElement textAlignment="Right" verticalAlignment="Top" markup="none">
					<font fontName="SansSerif" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{GeneralAsignado}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
